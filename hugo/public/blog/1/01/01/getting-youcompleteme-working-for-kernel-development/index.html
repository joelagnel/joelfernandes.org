<!DOCTYPE html>


<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <title>Getting YouCompleteMe Working for Kernel Development - JoelFernandes.org</title>
  <meta name="author" content="Joel Fernandes">

  
  <meta name="description" content="YCM is a pretty neat tool for speedy kernel development in vim. Especially when you don&amp;rsquo;t want to write a whole bunch of code, and then deal â€¦">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="canonical" href="http://localhost:1313/blog/1/01/01/getting-youcompleteme-working-for-kernel-development/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="\/javascripts\/libs\/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  
</head>
<body   >
  <header role="banner"><div>
<div style="margin-right:50px;float:left;">
  <h1><a href="/">JoelFernandes.org</a></h1>
  
</div>
<div style="float:left;" class="hnav">
 <br>
 
 <a href="/categories/">Blog posts by category.</a><br>
 <a href="/blog/archives/">Archive of all blog posts.</a><br>
 <a href="/resources/">Presentations and other work.</a><br>
</div>
<div style="float:right;">
<img src="/images/peng.png" height=100 width=100>
</div>
</div></header>

  <div id="main">
    <div id="content">
      
<div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Getting YouCompleteMe working for kernel development</h1>
    
    
      <p class="meta">
        
        
           | <a href="http://localhost:1313/blog/1/01/01/getting-youcompleteme-working-for-kernel-development/#disqus_thread"
             data-disqus-identifier="http://localhost:1313/blog/1/01/01/getting-youcompleteme-working-for-kernel-development/">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="https://github.com/Valloric/YouCompleteMe">YCM</a> is a pretty neat tool for
speedy kernel development in vim. Especially when you don&rsquo;t want to write a
whole bunch of code, and then deal with 100s of compiler errors. It is better
to fix the errors on the spot, as you write the code.  That&rsquo;s exactly what YCM
is best at since it constantly builds the code on the fly. The other great
thing about it among other things being, it will show you function prototypes
and so forth as you type, so you can call functions correctly with the right
set of parameters and types. YCM uses <a href="https://clangd.llvm.org/">clangd</a> under
the hood which understands code navigation, helps with code completion, and so
forth. <code>clangd</code> is used by a whole plehtora of IDEs and tools. I remember using
it when I tried to get <code>vscode</code> working with ChromeOS source navigation (which
is actually a bigger project in terms of lines of code, than the Linux
kernel!).</p>
<p>Interestingly YCM does not use <code>cscope</code> even if it is available, and they do
not want to support it. Further, they reluctantly support <code>ctags</code>. Since I
don&rsquo;t use <code>ctags</code>, I am not sure how having tags available changes YCM
behavior and how it works with <code>clangd</code>. But that is something worth trying.</p>
<p>Getting YCM working with vim is pretty easy, but requires a few steps.</p>
<p>First you have to build a <code>compile_commands.json</code> file in the kernel root. To
do so, run:</p>
<pre tabindex="0"><code>bear -- make -j99 CC=clang
</code></pre><p>Note the <code>CC</code> variable passed to Make. It has to be <code>clang</code>, otherwise YCM
throws a tonne of errors when it is in use. I believe that is because clangd
incorrectly passes gcc-specific options to clang, which are not all supported.</p>
<p>Following
<a href="https://stackoverflow.com/questions/30180064/how-to-setup-youcompleteme-for-kernel-and-device-driver-development">this</a>
stackoverflow post shows how to avoid some issues. This post is how I learnt to
use <code>bear</code>. Just use <code>bear</code> and ignore all other posts or articles that ask you
to create a <code>.ycm_extra_conf.py</code> file. I did not need to do that at all.</p>
<p>I faced the following issues:</p>
<ol>
<li>
<p>First, there might some warnings in the code that arise when clangd/clang
try to build your code on the fly. In case these warnings are not legit, it is
best to ignore them. For that the <code>g:ycm_filter_diagnostics</code> vim variable can
be defined.  The above post shows an example.</p>
</li>
<li>
<p>Editing header files may not work well: This happens because header files
cannot really be &ldquo;built&rdquo;. Further, sometimes header files require other header
files to be included, which may be done in the actual C file that includes the
header but not the header itself. However, vim/YCM does not know about that.
This issue can simply be fixed by including other header dependencies into the
header file being edited.</p>
</li>
<li>
<p>Kernel config macro dependencies: If a build has not happened yet, or you are
writing C code that depends on a new CONFIG option, a build may not have
happened yet, so the <code>autoconf</code> headers may not yet be available. This causes
YCM to not build those sections of code. A quick fix might be to add something
like this in the sources:</p>
</li>
</ol>
<pre tabindex="0"><code>#ifndef CONFIG_FOO_BAR
#define CONFIG_FOO_BAR
#endif
</code></pre><p>Similar tricks can be employed to satisfy macros such as <code>IS_ENABLED(CONFIG_FOO_BAR)</code>.</p>
<p>Hope this helps, do you have any other tips or ideas to use YCM better? If so,
let me know in the comments!</p>
</div>

  <footer>
    <p class="meta">
      
<span class="byline author vcard">Posted by <span class="fn">Joel Fernandes</span></span>
      
      <div class="post-categories">
  
    
      
      <a href="/categories/#vim">vim</a>
      &nbsp;
      
      <a href="/categories/#productivity">productivity</a>
      &nbsp;
      
    
  
</div>
    </p>
    
      <div class="sharing">
  
  
  
</div>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="http://localhost:1313/blog/1/01/01/gus-global-unbounded-sequences/" title="Previous Post: GUS (Global Unbounded Sequences)">&laquo; GUS (Global Unbounded Sequences)</a>
      
      
        <a class="basic-alignment right" href="http://localhost:1313/blog/1/01/01/figuring-out-herd7-memory-models/" title="Next Post: Figuring out herd7 memory models">Figuring out herd7 memory models &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>

</div>

<aside class="sidebar">
  <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="http://localhost:1313/blog/2023/06/25/svm-and-vectors-for-the-curious/">SVM and vectors for the curious</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/2018/12/22/dumping-user-and-kernel-stacks-on-kernel-events/">Dumping User and Kernel stacks on Kernel events</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/2018/02/10/usdt-for-reliable-userspace-event-tracing/">USDT for reliable Userspace event tracing</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/2016/12/31/armv8-flamegraph-and-nmi-support/">ARMv8: flamegraph and NMI support</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/2016/06/18/ftrace-events-mechanism/">Ftrace events mechanism</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/2016/03/20/tif_need_resched-why-is-it-needed/">TIF_NEED_RESCHED: why is it needed</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/2015/12/25/tying-2-voltage-sources/signals-together/">Tying 2 voltage sources/signals together</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/2014/06/04/microsd-card-remote-switch/">MicroSD card remote switch</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/2014/05/07/linux-spinlock-internals/">Linux Spinlock Internals</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/2014/04/24/studying-cache-line-sharing-effects-on-smp-systems/">Studying cache-line sharing effects on SMP systems</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/2014/04/22/design-of-fork-followed-by-exec-in-linux/">Design of fork followed by exec in Linux</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/"></a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/bpfd-running-bcc-tools-remotely-across-systems/">BPFd- Running BCC tools remotely across systems</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/c-rvalue-references/">C&#43;&#43; rvalue references</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/categories/">Categories</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/joel/">false</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/figuring-out-herd7-memory-models/">Figuring out herd7 memory models</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/getting-youcompleteme-working-for-kernel-development/">Getting YouCompleteMe working for kernel development</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/gus-global-unbounded-sequences/">GUS (Global Unbounded Sequences)</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/archives/">List of articles</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/making-sense-of-scheduler-deadlocks-in-rcu/">Making sense of scheduler deadlocks in RCU</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/modeling-lack-of-store-ordering-using-pluscal-and-a-wishlist/">Modeling (lack of) store ordering using PlusCal - and a wishlist</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/on-workings-of-hrtimers-slack-time-functionality/">On workings of hrtimer&#39;s slack time functionality</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/powerpc-stack-guard-false-positives-in-linux-kernel/">PowerPC stack guard false positives in Linux kernel</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/rcu-and-dynticks-idle-mode/">RCU and dynticks-idle mode</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/rcu-preempt-what-happens-on-a-context-switch/">RCU-preempt: What happens on a context switch</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/resources/">Resources</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/selinux-debugging-on-chromeos/">SELinux Debugging on ChromeOS</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/single-stepping-the-kernels-c-code/">Single-stepping the kernel&#39;s C code</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/srcu-state-double-scan/">SRCU state double scan</a>
      </li>
    
      <li class="post">
        <a href="http://localhost:1313/blog/1/01/01/understanding-hazard-pointers/">Understanding Hazard Pointers</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>About Me</h1>
  <p>A little something about me.</p>
</section>
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2025 - Joel Fernandes -
  <span class="credit">Powered by <a href="https://gohugo.io">Hugo</a></span>
</p></footer>
  
</body>
</html>