
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>GUS (Global Unbounded Sequences) - JoelFernandes.org</title>
  <meta name="author" content="Joel Fernandes">

  
  <meta name="description" content="

  
  
    
      GUS (Global Unbounded Sequences)
    
    
      
        










        
           | Comments
        
      
    
  


GU...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.linuxinternals.org/hugo/content/posts/04-24-2020-gus.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="" rel="alternate" title="JoelFernandes.org" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-50777115-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-50777115-1');
</script>

</head>

<body   >
  <header role="banner"><div>
<div style="margin-right:50px;float:left;">
  <h1><a href="/">JoelFernandes.org</a></h1>
  
  <!--
    1/29/2023:
    Changed from h2 to h6 to accomodate longer subtitle.
  -->
    <h6>Age is of no importance unless you're a cheese -- Billie Burke</h6>
  
</div>
<div style="float:left;" class="hnav">
 <br>
 <!--
   a href="/linuxinternals/">Linux Internals Articles</a><br>
 !-->
 <a href="/categories/">Blog posts by category.</a><br>
 <a href="/blog/archives/">Archive of all blog posts.</a><br>
 <a href="/resources">Presentations and other work.</a><br>
</div>
<div style="float:right;">
<img src="/images/peng.png" height=100 width=100>
</div>
</div>

</header>
<!--
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:http://www.linuxinternals.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/technical-resources/">Resources</a></li>
  <li><a href="/aboutme/">About me</a></li>
</ul>

</nav>
-->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">GUS (Global Unbounded Sequences)</h1>
    
    
      <p class="meta">
        










        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://www.linuxinternals.org">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>GUS is a memory reclaim algorithm used in FreeBSD, similar to RCU. It is
borrows concepts from Epoch and Parsec. A video of a presentation describing
the integration of GUS with UMA (FreeBSD’s slab implementation) is here:
https://www.youtube.com/watch?v=ZXUIFj4nRjk</p>

<p>The best description of GUS is in the FreeBSD code
<a href="http://bxr.su/FreeBSD/sys/kern/subr_smr.c#44">itself</a>. It is based on the
concept of global write clock, with readers catching up to writers.</p>

<p>Effectively, I see GUS as an implementation of light traveling from distant
stars. When a photon leaves a star, it is no longer needed by the star and is
ready to be reclaimed. However, on earth we can’t see the photon yet, we can
only see what we’ve been shown so far, and in a way, if we’ve not seen
something because enough “time” has not passed, then we may not reclaim it yet.
If we’ve not seen something, we will see it at some point in the future. Till
then we need to sit tight.</p>

<p>Roughly, an implementation has 2+N counters (with N CPUs):</p>
<ol>
  <li>Global write sequence.</li>
  <li>Global read sequence.</li>
  <li>Per-cpu read sequence (read from #1 when a reader starts)</li>
</ol>

<p>On freeing, the object is tagged with the write sequence. Only once global read
sequence has caught up with global write sequence, the object is freed. Until
then, the free’ing is deferred. The <code class="language-plaintext highlighter-rouge">poll()</code> operation updates #2 by referring
to #3 of all CPUs.  Whatever was tagged between the old read sequence and new
read sequence can be freed. This is similar to <code class="language-plaintext highlighter-rouge">synchronize_rcu()</code> in the Linux
kernel which waits for all readers to have finished observing the object being
reclaimed.</p>

<p>Note the scalability drawbacks of this reclaim scheme:</p>

<ol>
  <li>
    <p>Expensive poll operation if you have 1000s of CPUs.  (Note: Parsec uses a
tree-based mechanism to improve the situation which GUS could consider)</p>
  </li>
  <li>
    <p>Heavy-weight memory barriers are needed (SRCU has a similar drawback) to
ensure ordering properties of reader sections with respect to poll() operation.</p>
  </li>
  <li>
    <p>There can be a delay between reading the global write-sequence number and
writing it into the per-cpu read-sequence number. This can cause the per-cpu
read-sequence to advance past the global write-sequence. Special handling is
needed.</p>
  </li>
</ol>

<p>One advantage of the scheme could be implementation simplicity.</p>

<p>RCU (not SRCU or Userspace RCU) doesn’t suffer from these drawbacks.
Reader-sections in Linux kernel RCU are extremely scalable and lightweight.</p>
</div>


  <footer>
    <p class="meta">
      
<span class="byline author vcard">Posted by <span class="fn">Joel Fernandes</span></span>

      










      <!--
  Borrowed from: https://blog.webjeda.com/jekyll-categories/
  Added on 1/29/2023
-->
<div class="post-categories">
  
  
  <a href="/categories/#rcu, synchronization">rcu, synchronization</a>
  
  
</div>

<!--
Commented out on 1/29/2023:



<span class="categories">
  
    rcu, synchronization
  
  </span>

 -->

    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2025 - Joel Fernandes -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'linuxinternals1';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.linuxinternals.org/hugo/content/posts/04-24-2020-gus.html';
        var disqus_url = 'http://www.linuxinternals.org/hugo/content/posts/04-24-2020-gus.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
